{"version":3,"file":"ConversationalForm.js","sourceRoot":"","sources":["../../src/components/ConversationalForm.tsx"],"names":[],"mappings":";AAAA,OAAO,EAAE,OAAO,EAAE,MAAM,sBAAsB,CAAC;AAC/C,OAAO,EAAE,CAAC,EAAE,MAAM,KAAK,CAAC;AACxB,OAAO,EAAE,QAAQ,EAAE,SAAS,EAAE,MAAM,EAAE,MAAM,OAAO,CAAC;AACpD,OAAO,EAAE,MAAM,EAAE,MAAM,cAAc,CAAC;AACtC,OAAO,EAAE,KAAK,EAAE,MAAM,aAAa,CAAC;AACpC,OAAO,EAAE,KAAK,EAAE,MAAM,aAAa,CAAC;AACpC,OAAO,EACL,IAAI,EACJ,WAAW,EACX,eAAe,EACf,UAAU,EACV,SAAS,GACV,MAAM,YAAY,CAAC;AACpB,OAAO,EAAE,OAAO,EAAE,WAAW,EAAE,MAAM,eAAe,CAAC;AACrD,OAAO,EAAE,SAAS,EAAE,MAAM,kBAAkB,CAAC;AAC7C,OAAO,EAAE,WAAW,EAAE,IAAI,EAAE,GAAG,EAAE,MAAM,cAAc,CAAC;AACtD,OAAO,EACL,eAAe,EAEf,iBAAiB,EACjB,sBAAsB,GACvB,MAAM,wBAAwB,CAAC;AAEhC,6CAA6C;AAC7C,MAAM,wBAAwB,GAAG,CAAC,CAAC,MAAM,CAAC;IACxC,UAAU,EAAE,CAAC;SACV,MAAM,EAAE;SACR,GAAG,CAAC,IAAI,EAAE,qCAAqC,CAAC;SAChD,GAAG,CAAC,KAAK,EAAE,0CAA0C,CAAC;IACzD,QAAQ,EAAE,CAAC,CAAC,MAAM,EAAE,CAAC,GAAG,CAAC,CAAC,EAAE,uBAAuB,CAAC;IACpD,IAAI,EAAE,CAAC;SACJ,MAAM,EAAE;SACR,GAAG,CAAC,CAAC,EAAE,kBAAkB,CAAC;SAC1B,GAAG,CAAC,CAAC,EAAE,oCAAoC,CAAC;SAC5C,GAAG,CAAC,EAAE,EAAE,sCAAsC,CAAC;IAClD,KAAK,EAAE,CAAC;SACL,MAAM,EAAE;SACR,GAAG,CAAC,CAAC,EAAE,mBAAmB,CAAC;SAC3B,KAAK,CAAC,oCAAoC,CAAC;IAC9C,KAAK,EAAE,CAAC;SACL,MAAM,EAAE;SACR,GAAG,CAAC,CAAC,EAAE,0BAA0B,CAAC;SAClC,KAAK,CACJ,gCAAgC,EAChC,mCAAmC,CACpC;IACH,WAAW,EAAE,CAAC,CAAC,MAAM,EAAE,CAAC,QAAQ,EAAE,EAAE,gCAAgC;CACrE,CAAC,CAAC;AAwBH,MAAM,UAAU,kBAAkB,CAAC,EACjC,WAAW,GAAG,WAAW,EACzB,YAAY,EACZ,WAAW,MACgB,EAAE;;IAC7B,MAAM,CAAC,iBAAiB,EAAE,oBAAoB,CAAC,GAAG,QAAQ,CACxD;QACE,WAAW,EAAE,aAAa;QAC1B,QAAQ,EAAE;YACR;gBACE,EAAE,EAAE,GAAG;gBACP,IAAI,EAAE,WAAW;gBACjB,OAAO,EACL,mKAAmK;gBACrK,SAAS,EAAE,IAAI,IAAI,EAAE;aACtB;SACF;QACD,QAAQ,EAAE,EAAE;QACZ,QAAQ,EAAE,KAAK;KAChB,CACF,CAAC;IAEF,MAAM,CAAC,YAAY,EAAE,eAAe,CAAC,GAAG,QAAQ,CAAC,KAAK,CAAC,CAAC;IACxD,MAAM,CAAC,WAAW,EAAE,cAAc,CAAC,GAAG,QAAQ,CAAC,KAAK,CAAC,CAAC;IACtD,MAAM,cAAc,GAAG,MAAM,CAAiB,IAAI,CAAC,CAAC;IAEpD,MAAM,IAAI,GAAG,OAAO,CAAC;QACnB,aAAa,EAAE;YACb,UAAU,EAAE,EAAE,EAAE,wCAAwC;YACxD,QAAQ,EAAE,EAAE;YACZ,IAAI,EAAE,EAAE;YACR,KAAK,EAAE,EAAE;YACT,KAAK,EAAE,EAAE;YACT,WAAW,EAAE,EAAE;SAChB;QACD,QAAQ,EAAE,KAAK,EAAE,EAAE,KAAK,EAAE,EAAE,EAAE;YAC5B,eAAe,CAAC,IAAI,CAAC,CAAC;YACtB,IAAI,CAAC;gBACH,wCAAwC;gBACxC,MAAM,oBAAoB,GAAG,iBAAiB,CAAC,QAAQ;qBACpD,GAAG,CAAC,CAAC,GAAG,EAAE,EAAE,CAAC,GAAG,GAAG,CAAC,IAAI,CAAC,WAAW,EAAE,KAAK,GAAG,CAAC,OAAO,EAAE,CAAC;qBACzD,IAAI,CAAC,MAAM,CAAC,CAAC;gBAEhB,MAAM,cAAc,mCACf,KAAK,KACR,WAAW,EAAE,oBAAoB,GAClC,CAAC;gBAEF,MAAM,aAAa,GAAG,wBAAwB,CAAC,KAAK,CAAC,cAAc,CAAC,CAAC;gBACrE,MAAM,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,EAAE,CAAC,UAAU,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC,CAAC;gBAC1D,OAAO,CAAC,GAAG,CAAC,iBAAiB,EAAE,aAAa,CAAC,CAAC;gBAE9C,IAAI,YAAY,EAAE,CAAC;oBACjB,YAAY,CAAC,aAAa,CAAC,CAAC;gBAC9B,CAAC;gBAED,cAAc,CAAC,IAAI,CAAC,CAAC;YACvB,CAAC;YAAC,OAAO,KAAK,EAAE,CAAC;gBACf,OAAO,CAAC,KAAK,CAAC,wBAAwB,EAAE,KAAK,CAAC,CAAC;gBAC/C,IAAI,WAAW,EAAE,CAAC;oBAChB,WAAW,CAAC,KAAK,CAAC,CAAC;gBACrB,CAAC;YACH,CAAC;oBAAS,CAAC;gBACT,eAAe,CAAC,KAAK,CAAC,CAAC;YACzB,CAAC;QACH,CAAC;KACF,CAAC,CAAC;IAEH,iDAAiD;IACjD,SAAS,CAAC,GAAG,EAAE;;QACb,MAAA,cAAc,CAAC,OAAO,0CAAE,cAAc,CAAC,EAAE,QAAQ,EAAE,QAAQ,EAAE,CAAC,CAAC;IACjE,CAAC,EAAE,CAAC,iBAAiB,CAAC,QAAQ,CAAC,CAAC,CAAC;IAEjC,0DAA0D;IAC1D,SAAS,CAAC,GAAG,EAAE;QACb,OAAO,CAAC,GAAG,CACT,oCAAoC,EACpC,iBAAiB,CAAC,QAAQ,CAC3B,CAAC;QAEF,4DAA4D;QAC5D,MAAM,gBAAgB,mCACjB,iBAAiB,CAAC,QAAQ,KAC7B,WAAW,EAAE,iBAAiB,CAAC,QAAQ;iBACpC,GAAG,CAAC,CAAC,GAAG,EAAE,EAAE,CAAC,GAAG,GAAG,CAAC,IAAI,CAAC,WAAW,EAAE,KAAK,GAAG,CAAC,OAAO,EAAE,CAAC;iBACzD,IAAI,CAAC,MAAM,CAAC,GAChB,CAAC;QAEF,MAAM,CAAC,OAAO,CAAC,gBAAgB,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,KAAK,EAAE,KAAK,CAAC,EAAE,EAAE;YAC1D,OAAO,CAAC,GAAG,CAAC,qBAAqB,KAAK,YAAY,KAAK,EAAE,CAAC,CAAC;YAE3D,IAAI,KAAK,KAAK,SAAS,IAAI,KAAK,KAAK,IAAI,IAAI,KAAK,KAAK,EAAE,EAAE,CAAC;gBAC1D,OAAO,CAAC,GAAG,CAAC,kBAAkB,KAAK,cAAc,KAAK,EAAE,CAAC,CAAC;gBAC1D,IAAI,CAAC;oBACH,4CAA4C;oBAC5C,MAAM,SAAS,GACb,KAAK,KAAK,YAAY,IAAI,OAAO,KAAK,KAAK,QAAQ;wBACjD,CAAC,CAAC,KAAK,CAAC,QAAQ,EAAE;wBAClB,CAAC,CAAC,KAAK,CAAC;oBACZ,IAAI,CAAC,aAAa,CAAC,KAAuB,EAAE,MAAM,CAAC,SAAS,CAAC,CAAC,CAAC;oBAC/D,OAAO,CAAC,GAAG,CAAC,oBAAoB,KAAK,OAAO,SAAS,EAAE,CAAC,CAAC;gBAC3D,CAAC;gBAAC,OAAO,KAAK,EAAE,CAAC;oBACf,OAAO,CAAC,KAAK,CAAC,uBAAuB,KAAK,GAAG,EAAE,KAAK,CAAC,CAAC;gBACxD,CAAC;YACH,CAAC;iBAAM,CAAC;gBACN,OAAO,CAAC,GAAG,CAAC,kBAAkB,KAAK,sBAAsB,KAAK,EAAE,CAAC,CAAC;YACpE,CAAC;QACH,CAAC,CAAC,CAAC;IACL,CAAC,EAAE,CAAC,iBAAiB,CAAC,QAAQ,EAAE,iBAAiB,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,6BAA6B;IAE3F,MAAM,iBAAiB,GAAG,KAAK,EAAE,WAAmB,EAAE,EAAE;QACtD,MAAM,OAAO,GAAY;YACvB,EAAE,EAAE,IAAI,CAAC,GAAG,EAAE,CAAC,QAAQ,EAAE;YACzB,IAAI,EAAE,MAAM;YACZ,OAAO,EAAE,WAAW;YACpB,SAAS,EAAE,IAAI,IAAI,EAAE;SACtB,CAAC;QAEF,oBAAoB,CAAC,CAAC,IAAI,EAAE,EAAE,CAAC,iCAC1B,IAAI,KACP,QAAQ,EAAE,CAAC,GAAG,IAAI,CAAC,QAAQ,EAAE,OAAO,CAAC,EACrC,QAAQ,EAAE,IAAI,IACd,CAAC,CAAC;QAEJ,IAAI,CAAC;YACH,MAAM,QAAQ,GAAG,MAAM,KAAK,CAAC,WAAW,EAAE;gBACxC,MAAM,EAAE,MAAM;gBACd,OAAO,EAAE;oBACP,cAAc,EAAE,kBAAkB;iBACnC;gBACD,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC;oBACnB,QAAQ,EAAE,CAAC,GAAG,iBAAiB,CAAC,QAAQ,EAAE,OAAO,CAAC;oBAClD,WAAW,EAAE,iBAAiB,CAAC,WAAW;oBAC1C,QAAQ,EAAE,iBAAiB,CAAC,QAAQ;iBACrC,CAAC;aACH,CAAC,CAAC;YAEH,MAAM,IAAI,GAAG,MAAM,QAAQ,CAAC,IAAI,EAAE,CAAC;YAEnC,IAAI,IAAI,CAAC,KAAK,EAAE,CAAC;gBACf,MAAM,IAAI,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;YAC9B,CAAC;YAED,6DAA6D;YAC7D,MAAM,aAAa,GAAG,eAAe,CACnC,IAAI,CAAC,QAAQ,EACb,iBAAiB,CAAC,WAAW,CAC9B,CAAC;YAEF,MAAM,eAAe,mCAChB,iBAAiB,CAAC,QAAQ,GAC1B,aAAa,CACjB,CAAC;YAEF,MAAM,QAAQ,GAAG,iBAAiB,CAChC,iBAAiB,CAAC,WAAW,EAC7B,eAAe,CAChB,CAAC;YAEF,MAAM,YAAY,GAAY;gBAC5B,EAAE,EAAE,CAAC,IAAI,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC,CAAC,QAAQ,EAAE;gBAC/B,IAAI,EAAE,WAAW;gBACjB,OAAO,EAAE,IAAI,CAAC,QAAQ;gBACtB,SAAS,EAAE,IAAI,IAAI,EAAE;aACtB,CAAC;YAEF,oBAAoB,CAAC,CAAC,IAAI,EAAE,EAAE,CAAC,iCAC1B,IAAI,KACP,QAAQ,EAAE,CAAC,GAAG,IAAI,CAAC,QAAQ,EAAE,YAAY,CAAC,EAC1C,QAAQ,EAAE,eAAe,EACzB,WAAW,EAAE,QAAe,EAC5B,QAAQ,EAAE,KAAK,IACf,CAAC,CAAC;QACN,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,OAAO,CAAC,KAAK,CAAC,wBAAwB,EAAE,KAAK,CAAC,CAAC;YAC/C,IAAI,WAAW,EAAE,CAAC;gBAChB,WAAW,CAAC,KAAK,CAAC,CAAC;YACrB,CAAC;YACD,MAAM,QAAQ,GAAY;gBACxB,EAAE,EAAE,CAAC,IAAI,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC,CAAC,QAAQ,EAAE;gBAC/B,IAAI,EAAE,WAAW;gBACjB,OAAO,EAAE,4DAA4D;gBACrE,SAAS,EAAE,IAAI,IAAI,EAAE;aACtB,CAAC;YAEF,oBAAoB,CAAC,CAAC,IAAI,EAAE,EAAE,CAAC,iCAC1B,IAAI,KACP,QAAQ,EAAE,CAAC,GAAG,IAAI,CAAC,QAAQ,EAAE,QAAQ,CAAC,EACtC,QAAQ,EAAE,KAAK,IACf,CAAC,CAAC;QACN,CAAC;IACH,CAAC,CAAC;IAEF,yCAAyC;IACzC,MAAM,oBAAoB,GAAG,KAAK,IAAI,EAAE;QACtC,IAAI,cAAc,EAAE,CAAC;YACnB,MAAM,IAAI,CAAC,YAAY,EAAE,CAAC;QAC5B,CAAC;IACH,CAAC,CAAC;IAEF,MAAM,eAAe,GAAG,GAAG,EAAE;QAC3B,MAAM,KAAK,GAAG,CAAC,aAAa,EAAE,WAAW,EAAE,kBAAkB,CAAC,CAAC;QAC/D,MAAM,YAAY,GAAG,KAAK,CAAC,OAAO,CAAC,iBAAiB,CAAC,WAAW,CAAC,CAAC;QAClE,OAAO,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,YAAY,CAAC,CAAC;IACnC,CAAC,CAAC;IAEF,MAAM,cAAc,GAClB,iBAAiB,CAAC,QAAQ,CAAC,IAAI;QAC/B,iBAAiB,CAAC,QAAQ,CAAC,KAAK;QAChC,iBAAiB,CAAC,QAAQ,CAAC,KAAK;QAChC,iBAAiB,CAAC,QAAQ,CAAC,UAAU;QACrC,iBAAiB,CAAC,QAAQ,CAAC,QAAQ,CAAC;IAEtC,IAAI,WAAW,EAAE,CAAC;QAChB,OAAO,CACL,KAAC,IAAI,IAAC,SAAS,EAAC,0BAA0B,YACxC,MAAC,UAAU,eACT,MAAC,SAAS,IAAC,SAAS,EAAC,wCAAwC,aAC3D,KAAC,WAAW,IAAC,SAAS,EAAC,SAAS,GAAG,kBAEzB,EACZ,KAAC,eAAe,iGAGE,IACP,GACR,CACR,CAAC;IACJ,CAAC;IAED,OAAO,CACL,eAAK,SAAS,EAAC,oCAAoC,aAEjD,MAAC,IAAI,eACH,MAAC,UAAU,eACT,KAAC,SAAS,IAAC,SAAS,EAAC,SAAS,0CAAsC,EACpE,MAAC,eAAe,wBACR,eAAe,EAAE,GAAG,CAAC,YAAQ,GAAG,EACrC,iBAAiB,CAAC,WAAW,KAAK,aAAa;wCAC9C,CAAC,CAAC,aAAa;wCACf,CAAC,CAAC,iBAAiB,CAAC,WAAW,KAAK,WAAW;4CAC/C,CAAC,CAAC,WAAW;4CACb,CAAC,CAAC,iBAAiB,CAAC,WAAW,KAAK,kBAAkB;gDACtD,CAAC,CAAC,kBAAkB;gDACpB,CAAC,CAAC,UAAU,IACE,IACP,EACb,KAAC,WAAW,cACV,cAAK,SAAS,EAAC,gBAAgB,YAC5B,CAAC,aAAa,EAAE,WAAW,EAAE,kBAAkB,CAAC,CAAC,GAAG,CACnD,CAAC,IAAI,EAAE,KAAK,EAAE,EAAE;gCACd,MAAM,WAAW,GACf,iBAAiB,CAAC,QAAQ,CACxB,IAAI,KAAK,aAAa;oCACpB,CAAC,CAAC,YAAY;oCACd,CAAC,CAAC,IAAI,KAAK,WAAW;wCACtB,CAAC,CAAC,UAAU;wCACZ,CAAC,CAAC,MAAM,CACX,CAAC;gCACJ,MAAM,SAAS,GAAG,iBAAiB,CAAC,WAAW,KAAK,IAAI,CAAC;gCAEzD,OAAO,CACL,cAEE,SAAS,EAAE,2BACT,WAAW;wCACT,CAAC,CAAC,cAAc;wCAChB,CAAC,CAAC,SAAS;4CACX,CAAC,CAAC,aAAa;4CACf,CAAC,CAAC,aACN,EAAE,IAPG,IAAI,CAQT,CACH,CAAC;4BACJ,CAAC,CACF,GACG,GACM,IACT,EAEP,eAAK,SAAS,EAAC,uCAAuC,aAEpD,MAAC,IAAI,IAAC,SAAS,EAAC,yBAAyB,aACvC,MAAC,UAAU,eACT,MAAC,SAAS,IAAC,SAAS,EAAC,yBAAyB,aAC5C,KAAC,GAAG,IAAC,SAAS,EAAC,SAAS,GAAG,sBAEjB,EACZ,KAAC,eAAe,0EAEE,IACP,EACb,MAAC,WAAW,IAAC,SAAS,EAAC,0CAA0C,aAC/D,cAAK,SAAS,EAAC,wBAAwB,YACrC,MAAC,WAAW,eACT,iBAAiB,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,OAAO,EAAE,EAAE,CAAC,CAC3C,KAAC,OAAO,IAEN,IAAI,EAAE,OAAO,CAAC,IAAI,EAClB,OAAO,EAAE,OAAO,CAAC,OAAO,EACxB,SAAS,EAAE,OAAO,CAAC,SAAS,IAHvB,OAAO,CAAC,EAAE,CAIf,CACH,CAAC,EACD,iBAAiB,CAAC,QAAQ,IAAI,CAC7B,KAAC,OAAO,IAAC,IAAI,EAAC,WAAW,EAAC,OAAO,EAAC,EAAE,EAAC,QAAQ,EAAE,IAAI,GAAI,CACxD,EACD,cAAK,GAAG,EAAE,cAAc,GAAI,IAChB,GACV,EACL,sBAAsB,CACrB,CAAA,MAAA,iBAAiB,CAAC,QAAQ,CAAC,iBAAiB,CAAC,QAAQ,CAAC,MAAM,GAAG,CAAC,CAAC,0CAC7D,OAAO,KAAI,EAAE,EACjB,iBAAiB,CAAC,QAAQ,EAC1B,iBAAiB,CAAC,WAAW,CAC9B,CAAC,CAAC,CAAC,CACF,cAAK,SAAS,EAAC,cAAc,YAC3B,KAAC,MAAM,IACL,OAAO,EAAE,oBAAoB,EAC7B,QAAQ,EAAE,YAAY,EACtB,SAAS,EAAC,mCAAmC,YAE5C,YAAY,CAAC,CAAC,CAAC,CACd,eAAK,SAAS,EAAC,yBAAyB,aACtC,cAAK,SAAS,EAAC,gFAAgF,GAAO,iCAElG,CACP,CAAC,CAAC,CAAC,CACF,oBAAoB,CACrB,GACM,GACL,CACP,CAAC,CAAC,CAAC,CACF,KAAC,SAAS,IACR,aAAa,EAAE,iBAAiB,EAChC,QAAQ,EAAE,OAAO,CAAC,iBAAiB,CAAC,QAAQ,IAAI,cAAc,CAAC,EAC/D,WAAW,EACT,iBAAiB,CAAC,WAAW,KAAK,aAAa;4CAC7C,CAAC,CAAC,sBAAsB;4CACxB,CAAC,CAAC,iBAAiB,CAAC,WAAW,KAAK,WAAW;gDAC/C,CAAC,CAAC,qBAAqB;gDACvB,CAAC,CAAC,yBAAyB,GAE/B,CACH,IACW,IACT,EAGP,MAAC,IAAI,IAAC,SAAS,EAAC,yBAAyB,aACvC,MAAC,UAAU,eACT,MAAC,SAAS,IAAC,SAAS,EAAC,yBAAyB,aAC5C,KAAC,IAAI,IAAC,SAAS,EAAC,SAAS,GAAG,2BAElB,EACZ,KAAC,eAAe,6DAEE,IACP,EACb,MAAC,WAAW,IAAC,SAAS,EAAC,sBAAsB,aAC3C,eAAK,SAAS,EAAC,kBAAkB,aAE/B,eAAK,SAAS,EAAC,WAAW,aACxB,KAAC,KAAK,8BAAoB,EAC1B,eAAK,SAAS,EAAC,yBAAyB,aACtC,KAAC,KAAK,IACJ,KAAK,EACH,iBAAiB,CAAC,QAAQ,CAAC,UAAU;oEACnC,CAAC,CAAC,IAAI,iBAAiB,CAAC,QAAQ,CAAC,UAAU,CAAC,cAAc,EAAE,EAAE;oEAC9D,CAAC,CAAC,EAAE,EAER,WAAW,EAAC,kCAAkC,EAC9C,QAAQ,QACR,SAAS,EAAC,YAAY,GACtB,EACD,iBAAiB,CAAC,QAAQ,CAAC,UAAU,IAAI,CACxC,KAAC,WAAW,IAAC,SAAS,EAAC,wBAAwB,GAAG,CACnD,IACG,IACF,EAGN,eAAK,SAAS,EAAC,WAAW,aACxB,KAAC,KAAK,4BAAkB,EACxB,eAAK,SAAS,EAAC,yBAAyB,aACtC,KAAC,KAAK,IACJ,KAAK,EAAE,iBAAiB,CAAC,QAAQ,CAAC,QAAQ,IAAI,EAAE,EAChD,WAAW,EAAC,kCAAkC,EAC9C,QAAQ,QACR,SAAS,EAAC,YAAY,GACtB,EACD,iBAAiB,CAAC,QAAQ,CAAC,QAAQ,IAAI,CACtC,KAAC,WAAW,IAAC,SAAS,EAAC,wBAAwB,GAAG,CACnD,IACG,IACF,EAGN,eAAK,SAAS,EAAC,WAAW,aACxB,KAAC,KAAK,4BAAkB,EACxB,eAAK,SAAS,EAAC,yBAAyB,aACtC,KAAC,KAAK,IACJ,KAAK,EAAE,iBAAiB,CAAC,QAAQ,CAAC,IAAI,IAAI,EAAE,EAC5C,WAAW,EAAC,kCAAkC,EAC9C,QAAQ,QACR,SAAS,EAAC,YAAY,GACtB,EACD,iBAAiB,CAAC,QAAQ,CAAC,IAAI,IAAI,CAClC,KAAC,WAAW,IAAC,SAAS,EAAC,wBAAwB,GAAG,CACnD,IACG,IACF,EAEN,eAAK,SAAS,EAAC,WAAW,aACxB,KAAC,KAAK,gCAAsB,EAC5B,eAAK,SAAS,EAAC,yBAAyB,aACtC,KAAC,KAAK,IACJ,KAAK,EAAE,iBAAiB,CAAC,QAAQ,CAAC,KAAK,IAAI,EAAE,EAC7C,WAAW,EAAC,kCAAkC,EAC9C,QAAQ,QACR,SAAS,EAAC,YAAY,GACtB,EACD,iBAAiB,CAAC,QAAQ,CAAC,KAAK,IAAI,CACnC,KAAC,WAAW,IAAC,SAAS,EAAC,wBAAwB,GAAG,CACnD,IACG,IACF,EAEN,eAAK,SAAS,EAAC,WAAW,aACxB,KAAC,KAAK,+BAAqB,EAC3B,eAAK,SAAS,EAAC,yBAAyB,aACtC,KAAC,KAAK,IACJ,KAAK,EAAE,iBAAiB,CAAC,QAAQ,CAAC,KAAK,IAAI,EAAE,EAC7C,WAAW,EAAC,kCAAkC,EAC9C,QAAQ,QACR,SAAS,EAAC,YAAY,GACtB,EACD,iBAAiB,CAAC,QAAQ,CAAC,KAAK,IAAI,CACnC,KAAC,WAAW,IAAC,SAAS,EAAC,wBAAwB,GAAG,CACnD,IACG,IACF,IACF,EAGN,cAAK,SAAS,EAAC,eAAe,YAC5B,KAAC,MAAM,IACL,OAAO,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,YAAY,EAAE,EAClC,SAAS,EAAC,QAAQ,EAClB,QAAQ,EAAE,CAAC,cAAc,IAAI,YAAY,YAExC,YAAY,CAAC,CAAC,CAAC,eAAe,CAAC,CAAC,CAAC,oBAAoB,GAC/C,GACL,IACM,IACT,IACH,IACF,CACP,CAAC;AACJ,CAAC","sourcesContent":["import { useForm } from \"@tanstack/react-form\";\r\nimport { z } from \"zod\";\r\nimport { useState, useEffect, useRef } from \"react\";\r\nimport { Button } from \"../ui/button\";\r\nimport { Input } from \"../ui/input\";\r\nimport { Label } from \"../ui/label\";\r\nimport {\r\n  Card,\r\n  CardContent,\r\n  CardDescription,\r\n  CardHeader,\r\n  CardTitle,\r\n} from \"../ui/card\";\r\nimport { Message, MessageList } from \"../ui/message\";\r\nimport { ChatInput } from \"../ui/chat-input\";\r\nimport { CheckCircle, User, Bot } from \"lucide-react\";\r\nimport {\r\n  parseAIResponse,\r\n  ExtractedData,\r\n  determineNextStep,\r\n  shouldShowSubmitButton,\r\n} from \"../lib/data-extraction\";\r\n\r\n// Updated Zod schema to include chat history\r\nconst conversationalFormSchema = z.object({\r\n  loanAmount: z\r\n    .number()\r\n    .min(1000, \"Loan amount must be at least $1,000\")\r\n    .max(40000, \"Loan amount must be no more than $40,000\"),\r\n  loanType: z.string().min(1, \"Loan type is required\"),\r\n  name: z\r\n    .string()\r\n    .min(1, \"Name is required\")\r\n    .min(2, \"Name must be at least 2 characters\")\r\n    .max(50, \"Name must be less than 50 characters\"),\r\n  email: z\r\n    .string()\r\n    .min(1, \"Email is required\")\r\n    .email(\"Please enter a valid email address\"),\r\n  phone: z\r\n    .string()\r\n    .min(1, \"Phone number is required\")\r\n    .regex(\r\n      /^[\\+]?[1-9][\\d\\s\\-\\(\\)]{7,15}$/,\r\n      \"Please enter a valid phone number\"\r\n    ),\r\n  chatHistory: z.string().optional(), // Hidden field for chat history\r\n});\r\n\r\ntype FormData = z.infer<typeof conversationalFormSchema>;\r\n\r\ninterface Message {\r\n  id: string;\r\n  role: \"user\" | \"assistant\" | \"system\";\r\n  content: string;\r\n  timestamp: Date;\r\n}\r\n\r\ninterface ConversationState {\r\n  currentStep: \"loan_amount\" | \"loan_type\" | \"personal_details\" | \"complete\";\r\n  messages: Message[];\r\n  formData: ExtractedData;\r\n  isTyping: boolean;\r\n}\r\n\r\ninterface ConversationalFormProps {\r\n  apiEndpoint?: string;\r\n  onFormSubmit?: (data: any) => void;\r\n  onFormError?: (error: any) => void;\r\n}\r\n\r\nexport function ConversationalForm({\r\n  apiEndpoint = \"/api/chat\",\r\n  onFormSubmit,\r\n  onFormError,\r\n}: ConversationalFormProps = {}) {\r\n  const [conversationState, setConversationState] = useState<ConversationState>(\r\n    {\r\n      currentStep: \"loan_amount\",\r\n      messages: [\r\n        {\r\n          id: \"1\",\r\n          role: \"assistant\",\r\n          content:\r\n            \"Hi! I'm here to help you with your loan application. What loan amount are you considering? Please note that we only work with amounts between $1,000 and $40,000.\",\r\n          timestamp: new Date(),\r\n        },\r\n      ],\r\n      formData: {},\r\n      isTyping: false,\r\n    }\r\n  );\r\n\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [isSubmitted, setIsSubmitted] = useState(false);\r\n  const messagesEndRef = useRef<HTMLDivElement>(null);\r\n\r\n  const form = useForm({\r\n    defaultValues: {\r\n      loanAmount: \"\", // Change from undefined to empty string\r\n      loanType: \"\",\r\n      name: \"\",\r\n      email: \"\",\r\n      phone: \"\",\r\n      chatHistory: \"\",\r\n    },\r\n    onSubmit: async ({ value }) => {\r\n      setIsSubmitting(true);\r\n      try {\r\n        // Format chat history before submission\r\n        const formattedChatHistory = conversationState.messages\r\n          .map((msg) => `${msg.role.toUpperCase()}: ${msg.content}`)\r\n          .join(\"\\n\\n\");\r\n\r\n        const submissionData = {\r\n          ...value,\r\n          chatHistory: formattedChatHistory,\r\n        };\r\n\r\n        const validatedData = conversationalFormSchema.parse(submissionData);\r\n        await new Promise((resolve) => setTimeout(resolve, 1000));\r\n        console.log(\"Form submitted:\", validatedData);\r\n\r\n        if (onFormSubmit) {\r\n          onFormSubmit(validatedData);\r\n        }\r\n\r\n        setIsSubmitted(true);\r\n      } catch (error) {\r\n        console.error(\"Error submitting form:\", error);\r\n        if (onFormError) {\r\n          onFormError(error);\r\n        }\r\n      } finally {\r\n        setIsSubmitting(false);\r\n      }\r\n    },\r\n  });\r\n\r\n  // Auto-scroll to bottom when new messages arrive\r\n  useEffect(() => {\r\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\r\n  }, [conversationState.messages]);\r\n\r\n  // Update the useEffect to also handle chatHistory updates\r\n  useEffect(() => {\r\n    console.log(\r\n      \"useEffect triggered with formData:\",\r\n      conversationState.formData\r\n    );\r\n\r\n    // Create a complete form data object including chat history\r\n    const completeFormData = {\r\n      ...conversationState.formData,\r\n      chatHistory: conversationState.messages\r\n        .map((msg) => `${msg.role.toUpperCase()}: ${msg.content}`)\r\n        .join(\"\\n\\n\"),\r\n    };\r\n\r\n    Object.entries(completeFormData).forEach(([field, value]) => {\r\n      console.log(`Processing field: ${field}, value: ${value}`);\r\n\r\n      if (value !== undefined && value !== null && value !== \"\") {\r\n        console.log(`Setting field: ${field} to value: ${value}`);\r\n        try {\r\n          // Convert loanAmount to string for the form\r\n          const formValue =\r\n            field === \"loanAmount\" && typeof value === \"number\"\r\n              ? value.toString()\r\n              : value;\r\n          form.setFieldValue(field as keyof FormData, String(formValue));\r\n          console.log(`Successfully set ${field} to ${formValue}`);\r\n        } catch (error) {\r\n          console.error(`Error setting field ${field}:`, error);\r\n        }\r\n      } else {\r\n        console.log(`Skipping field ${field} - value is falsy: ${value}`);\r\n      }\r\n    });\r\n  }, [conversationState.formData, conversationState.messages]); // Add messages to dependency\r\n\r\n  const handleSendMessage = async (userMessage: string) => {\r\n    const userMsg: Message = {\r\n      id: Date.now().toString(),\r\n      role: \"user\",\r\n      content: userMessage,\r\n      timestamp: new Date(),\r\n    };\r\n\r\n    setConversationState((prev) => ({\r\n      ...prev,\r\n      messages: [...prev.messages, userMsg],\r\n      isTyping: true,\r\n    }));\r\n\r\n    try {\r\n      const response = await fetch(apiEndpoint, {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n        body: JSON.stringify({\r\n          messages: [...conversationState.messages, userMsg],\r\n          currentStep: conversationState.currentStep,\r\n          formData: conversationState.formData,\r\n        }),\r\n      });\r\n\r\n      const data = await response.json();\r\n\r\n      if (data.error) {\r\n        throw new Error(data.error);\r\n      }\r\n\r\n      // Extract data from AI response (only on final confirmation)\r\n      const extractedData = parseAIResponse(\r\n        data.response,\r\n        conversationState.currentStep\r\n      );\r\n\r\n      const updatedFormData = {\r\n        ...conversationState.formData,\r\n        ...extractedData,\r\n      };\r\n\r\n      const nextStep = determineNextStep(\r\n        conversationState.currentStep,\r\n        updatedFormData\r\n      );\r\n\r\n      const assistantMsg: Message = {\r\n        id: (Date.now() + 1).toString(),\r\n        role: \"assistant\",\r\n        content: data.response,\r\n        timestamp: new Date(),\r\n      };\r\n\r\n      setConversationState((prev) => ({\r\n        ...prev,\r\n        messages: [...prev.messages, assistantMsg],\r\n        formData: updatedFormData,\r\n        currentStep: nextStep as any,\r\n        isTyping: false,\r\n      }));\r\n    } catch (error) {\r\n      console.error(\"Error sending message:\", error);\r\n      if (onFormError) {\r\n        onFormError(error);\r\n      }\r\n      const errorMsg: Message = {\r\n        id: (Date.now() + 1).toString(),\r\n        role: \"assistant\",\r\n        content: \"I apologize, but I encountered an error. Please try again.\",\r\n        timestamp: new Date(),\r\n      };\r\n\r\n      setConversationState((prev) => ({\r\n        ...prev,\r\n        messages: [...prev.messages, errorMsg],\r\n        isTyping: false,\r\n      }));\r\n    }\r\n  };\r\n\r\n  // Add function to handle chat submission\r\n  const handleChatSubmission = async () => {\r\n    if (isFormComplete) {\r\n      await form.handleSubmit();\r\n    }\r\n  };\r\n\r\n  const getStepProgress = () => {\r\n    const steps = [\"loan_amount\", \"loan_type\", \"personal_details\"];\r\n    const currentIndex = steps.indexOf(conversationState.currentStep);\r\n    return Math.max(0, currentIndex);\r\n  };\r\n\r\n  const isFormComplete =\r\n    conversationState.formData.name &&\r\n    conversationState.formData.email &&\r\n    conversationState.formData.phone &&\r\n    conversationState.formData.loanAmount &&\r\n    conversationState.formData.loanType;\r\n\r\n  if (isSubmitted) {\r\n    return (\r\n      <Card className=\"w-full max-w-4xl mx-auto\">\r\n        <CardHeader>\r\n          <CardTitle className=\"text-green-600 flex items-center gap-2\">\r\n            <CheckCircle className=\"h-6 w-6\" />\r\n            Thank You!\r\n          </CardTitle>\r\n          <CardDescription>\r\n            Your loan application has been submitted successfully. We'll be in\r\n            touch soon!\r\n          </CardDescription>\r\n        </CardHeader>\r\n      </Card>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"w-full max-w-4xl mx-auto space-y-6\">\r\n      {/* Progress Indicator */}\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle className=\"text-lg\">Loan Application Progress</CardTitle>\r\n          <CardDescription>\r\n            Step {getStepProgress() + 1} of 3:{\" \"}\r\n            {conversationState.currentStep === \"loan_amount\"\r\n              ? \"Loan Amount\"\r\n              : conversationState.currentStep === \"loan_type\"\r\n              ? \"Loan Type\"\r\n              : conversationState.currentStep === \"personal_details\"\r\n              ? \"Personal Details\"\r\n              : \"Complete\"}\r\n          </CardDescription>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"flex space-x-2\">\r\n            {[\"loan_amount\", \"loan_type\", \"personal_details\"].map(\r\n              (step, index) => {\r\n                const isCompleted =\r\n                  conversationState.formData[\r\n                    step === \"loan_amount\"\r\n                      ? \"loanAmount\"\r\n                      : step === \"loan_type\"\r\n                      ? \"loanType\"\r\n                      : \"name\"\r\n                  ];\r\n                const isCurrent = conversationState.currentStep === step;\r\n\r\n                return (\r\n                  <div\r\n                    key={step}\r\n                    className={`flex-1 h-2 rounded-full ${\r\n                      isCompleted\r\n                        ? \"bg-green-500\"\r\n                        : isCurrent\r\n                        ? \"bg-blue-500\"\r\n                        : \"bg-gray-200\"\r\n                    }`}\r\n                  />\r\n                );\r\n              }\r\n            )}\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n        {/* Chat Interface */}\r\n        <Card className=\"h-[600px] flex flex-col\">\r\n          <CardHeader>\r\n            <CardTitle className=\"flex items-center gap-2\">\r\n              <Bot className=\"h-5 w-5\" />\r\n              Loan Assistant\r\n            </CardTitle>\r\n            <CardDescription>\r\n              Chat with our AI assistant to complete your application\r\n            </CardDescription>\r\n          </CardHeader>\r\n          <CardContent className=\"flex-1 flex flex-col p-0 overflow-y-auto\">\r\n            <div className=\"flex-1 overflow-y-auto\">\r\n              <MessageList>\r\n                {conversationState.messages.map((message) => (\r\n                  <Message\r\n                    key={message.id}\r\n                    role={message.role}\r\n                    content={message.content}\r\n                    timestamp={message.timestamp}\r\n                  />\r\n                ))}\r\n                {conversationState.isTyping && (\r\n                  <Message role=\"assistant\" content=\"\" isTyping={true} />\r\n                )}\r\n                <div ref={messagesEndRef} />\r\n              </MessageList>\r\n            </div>\r\n            {shouldShowSubmitButton(\r\n              conversationState.messages[conversationState.messages.length - 1]\r\n                ?.content || \"\",\r\n              conversationState.formData,\r\n              conversationState.currentStep\r\n            ) ? (\r\n              <div className=\"p-4 border-t\">\r\n                <Button\r\n                  onClick={handleChatSubmission}\r\n                  disabled={isSubmitting}\r\n                  className=\"w-full h-12 text-lg font-semibold\"\r\n                >\r\n                  {isSubmitting ? (\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <div className=\"h-4 w-4 animate-spin rounded-full border-2 border-current border-t-transparent\"></div>\r\n                      Submitting Application...\r\n                    </div>\r\n                  ) : (\r\n                    \"Submit Application\"\r\n                  )}\r\n                </Button>\r\n              </div>\r\n            ) : (\r\n              <ChatInput\r\n                onSendMessage={handleSendMessage}\r\n                disabled={Boolean(conversationState.isTyping || isFormComplete)}\r\n                placeholder={\r\n                  conversationState.currentStep === \"loan_amount\"\r\n                    ? \"Enter loan amount...\"\r\n                    : conversationState.currentStep === \"loan_type\"\r\n                    ? \"Choose loan type...\"\r\n                    : \"Provide your details...\"\r\n                }\r\n              />\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n\r\n        {/* Form Preview */}\r\n        <Card className=\"h-[600px] flex flex-col\">\r\n          <CardHeader>\r\n            <CardTitle className=\"flex items-center gap-2\">\r\n              <User className=\"h-5 w-5\" />\r\n              Application Summary\r\n            </CardTitle>\r\n            <CardDescription>\r\n              Your information will be filled as we chat\r\n            </CardDescription>\r\n          </CardHeader>\r\n          <CardContent className=\"flex-1 flex flex-col\">\r\n            <div className=\"flex-1 space-y-4\">\r\n              {/* Loan Amount */}\r\n              <div className=\"space-y-2\">\r\n                <Label>Loan Amount</Label>\r\n                <div className=\"flex items-center gap-2\">\r\n                  <Input\r\n                    value={\r\n                      conversationState.formData.loanAmount\r\n                        ? `$${conversationState.formData.loanAmount.toLocaleString()}`\r\n                        : \"\"\r\n                    }\r\n                    placeholder=\"Will be filled from conversation\"\r\n                    disabled\r\n                    className=\"bg-gray-50\"\r\n                  />\r\n                  {conversationState.formData.loanAmount && (\r\n                    <CheckCircle className=\"h-5 w-5 text-green-500\" />\r\n                  )}\r\n                </div>\r\n              </div>\r\n\r\n              {/* Loan Type */}\r\n              <div className=\"space-y-2\">\r\n                <Label>Loan Type</Label>\r\n                <div className=\"flex items-center gap-2\">\r\n                  <Input\r\n                    value={conversationState.formData.loanType || \"\"}\r\n                    placeholder=\"Will be filled from conversation\"\r\n                    disabled\r\n                    className=\"bg-gray-50\"\r\n                  />\r\n                  {conversationState.formData.loanType && (\r\n                    <CheckCircle className=\"h-5 w-5 text-green-500\" />\r\n                  )}\r\n                </div>\r\n              </div>\r\n\r\n              {/* Personal Details */}\r\n              <div className=\"space-y-2\">\r\n                <Label>Full Name</Label>\r\n                <div className=\"flex items-center gap-2\">\r\n                  <Input\r\n                    value={conversationState.formData.name || \"\"}\r\n                    placeholder=\"Will be filled from conversation\"\r\n                    disabled\r\n                    className=\"bg-gray-50\"\r\n                  />\r\n                  {conversationState.formData.name && (\r\n                    <CheckCircle className=\"h-5 w-5 text-green-500\" />\r\n                  )}\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"space-y-2\">\r\n                <Label>Email Address</Label>\r\n                <div className=\"flex items-center gap-2\">\r\n                  <Input\r\n                    value={conversationState.formData.email || \"\"}\r\n                    placeholder=\"Will be filled from conversation\"\r\n                    disabled\r\n                    className=\"bg-gray-50\"\r\n                  />\r\n                  {conversationState.formData.email && (\r\n                    <CheckCircle className=\"h-5 w-5 text-green-500\" />\r\n                  )}\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"space-y-2\">\r\n                <Label>Phone Number</Label>\r\n                <div className=\"flex items-center gap-2\">\r\n                  <Input\r\n                    value={conversationState.formData.phone || \"\"}\r\n                    placeholder=\"Will be filled from conversation\"\r\n                    disabled\r\n                    className=\"bg-gray-50\"\r\n                  />\r\n                  {conversationState.formData.phone && (\r\n                    <CheckCircle className=\"h-5 w-5 text-green-500\" />\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Submit Button */}\r\n            <div className=\"pt-4 border-t\">\r\n              <Button\r\n                onClick={() => form.handleSubmit()}\r\n                className=\"w-full\"\r\n                disabled={!isFormComplete || isSubmitting}\r\n              >\r\n                {isSubmitting ? \"Submitting...\" : \"Submit Application\"}\r\n              </Button>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"]}